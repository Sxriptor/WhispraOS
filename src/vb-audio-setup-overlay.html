<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VB-Audio Setup Guide - Whispra</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            margin: 0;
            padding: 1rem;
        }

        .overlay-container {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logo {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            background: url('assets/favicon-32x32.png') no-repeat center center;
            background-size: contain;
            border-radius: 8px;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: #000;
        }

        .subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 1.5rem;
        }

        .windows-version-tabs {
            display: flex;
            background: #f5f5f5;
            border-radius: 8px;
            padding: 3px;
            margin-bottom: 1rem;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .tab-button {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
        }

        .tab-button.active {
            background: #000;
            color: #fff;
        }

        .tab-button:hover:not(.active) {
            background: #e5e5e5;
        }

        .setup-content {
            text-align: left;
            background: #f9f9f9;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .setup-section {
            display: none;
        }

        .setup-section.active {
            display: block;
        }

        .setup-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #000;
            text-align: center;
        }

        .steps-list {
            list-style: none;
            counter-reset: step-counter;
        }

        .step-item {
            counter-increment: step-counter;
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .step-number {
            background: #000;
            color: #fff;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .step-number::before {
            content: counter(step-counter);
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #000;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .step-description {
            color: #555;
            line-height: 1.4;
            margin-bottom: 0.25rem;
            font-size: 0.85rem;
        }

        .step-image {
            background: #e5e7eb;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 0.5rem;
            margin-top: 0.25rem;
            text-align: center;
            color: #666;
            font-style: italic;
            font-size: 0.8rem;
        }

        .important-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 0.75rem;
            margin: 1rem 0;
        }

        .important-note .note-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .important-note .note-content {
            color: #856404;
            font-size: 0.8rem;
            line-height: 1.3;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.6rem 1.25rem;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-primary {
            background: #000;
            color: #fff;
        }

        .btn-primary:hover {
            background: #333;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #000;
            border: 1px solid #ccc;
        }

        .btn-secondary:hover {
            background: #e5e5e5;
        }

        @media (max-width: 640px) {
            .overlay-container {
                padding: 1.5rem;
                margin: 1rem;
            }

            .title {
                font-size: 1.5rem;
            }

            .setup-content {
                padding: 1.5rem;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .windows-version-tabs {
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="overlay-container">
        <div class="logo"></div>
        <h1 class="title">VB-Audio Setup Guide</h1>
        <p class="subtitle">Set VB-Audio Cable as your default microphone for Discord, games, and other apps</p>

        <div class="windows-version-tabs">
            <button id="windows10-tab" class="tab-button active">Windows 10</button>
            <button id="windows11-tab" class="tab-button">Windows 11</button>
        </div>

        <div class="setup-content">
            <!-- Windows 10 Setup -->
            <div id="windows10-setup" class="setup-section active">
                <h2 class="setup-title">Windows 10 Setup Instructions</h2>
                <ol class="steps-list">
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Right-click the volume icon</div>
                            <div class="step-description">Right-click the volume/speaker icon in your system tray (bottom-right corner)</div>
                            <div class="step-image">ðŸ”Š Right-click volume icon in taskbar</div>
                        </div>
                    </li>
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Open Sounds</div>
                            <div class="step-description">Click on "Sounds" from the context menu</div>
                            <div class="step-image">Click "Sounds" option</div>
                        </div>
                    </li>
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Go to Recording tab</div>
                            <div class="step-description">In the Sound dialog, click on the "Recording" tab</div>
                            <div class="step-image">Switch to "Recording" tab</div>
                        </div>
                    </li>
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Select CABLE Output</div>
                            <div class="step-description">Find and click on "CABLE Output (VB-Audio Virtual Cable)" in the list</div>
                            <div class="step-image">Select "CABLE Output (VB-Audio Virtual Cable)"</div>
                        </div>
                    </li>
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Set as Default</div>
                            <div class="step-description">Click the "Set Default" button to make it your default microphone</div>
                            <div class="step-image">Click "Set Default" button</div>
                        </div>
                    </li>
                </ol>
            </div>

            <!-- Windows 11 Setup -->
            <div id="windows11-setup" class="setup-section">
                <h2 class="setup-title">Windows 11 Setup Instructions</h2>
                <ol class="steps-list">
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Right-click the volume icon</div>
                            <div class="step-description">Right-click the volume/speaker icon in your system tray (bottom-right corner)</div>
                            <div class="step-image">ðŸ”Š Right-click volume icon in taskbar</div>
                        </div>
                    </li>
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Open Sound settings</div>
                            <div class="step-description">Click on "Sound settings" from the context menu</div>
                            <div class="step-image">Click "Sound settings" option</div>
                        </div>
                    </li>
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Find Input section</div>
                            <div class="step-description">Scroll down to the "Input" section in the Sound settings</div>
                            <div class="step-image">Locate "Input" section</div>
                        </div>
                    </li>
                    <li class="step-item">
                        <div class="step-number"></div>
                        <div class="step-content">
                            <div class="step-title">Select CABLE Output</div>
                            <div class="step-description">Click the dropdown next to "Choose your input device" and select "CABLE Output (VB-Audio Virtual Cable)"</div>
                            <div class="step-image">Select "CABLE Output (VB-Audio Virtual Cable)" from dropdown</div>
                        </div>
                    </li>
                </ol>
            </div>

            <div class="important-note">
                <div class="note-title">ðŸŽ¯ Why This Matters</div>
                <div class="note-content">
                    Setting VB-Audio Cable as your default microphone allows Discord, games, and other applications to receive the translated audio from Whispra. Your real microphone will still work through the translation app.
                </div>
            </div>
        </div>

        <div class="button-group">
            <button id="open-sound-settings-btn" class="btn btn-secondary">
                <span>ðŸ”Š</span>
                Open Sound Settings
            </button>
            <button id="test-setup-btn" class="btn btn-secondary">
                <span>ðŸŽ¤</span>
                Test My Setup
            </button>
            <button id="got-it-btn" class="btn btn-primary">
                <span>âœ…</span>
                Got It!
            </button>
        </div>
    </div>


    <script>
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', () => {
            setupTabSwitching();
            setupEventListeners();
            detectWindowsVersion();
        });

        function setupTabSwitching() {
            const windows10Tab = document.getElementById('windows10-tab');
            const windows11Tab = document.getElementById('windows11-tab');
            const windows10Setup = document.getElementById('windows10-setup');
            const windows11Setup = document.getElementById('windows11-setup');

            windows10Tab.addEventListener('click', () => {
                windows10Tab.classList.add('active');
                windows11Tab.classList.remove('active');
                windows10Setup.classList.add('active');
                windows11Setup.classList.remove('active');
            });

            windows11Tab.addEventListener('click', () => {
                windows11Tab.classList.add('active');
                windows10Tab.classList.remove('active');
                windows11Setup.classList.add('active');
                windows10Setup.classList.remove('active');
            });
        }

        function setupEventListeners() {
            document.getElementById('open-sound-settings-btn').addEventListener('click', openSoundSettings);
            document.getElementById('test-setup-btn').addEventListener('click', testSetup);
            document.getElementById('got-it-btn').addEventListener('click', closeOverlay);
        }

        function detectWindowsVersion() {
            try {
                const userAgent = navigator.userAgent;
                
                if (userAgent.includes('Windows NT 10.0')) {
                    const buildNumber = parseInt(userAgent.match(/Windows NT 10\.0; Win64; x64.*?(\d{5})/)?.[1] || '0');
                    
                    if (buildNumber >= 22000) {
                        document.getElementById('windows11-tab').click();
                    }
                }
            } catch (error) {
                console.warn('Could not detect Windows version:', error);
            }
        }

        async function openSoundSettings() {
            try {
                await window.electronAPI.openSoundSettings();
            } catch (error) {
                console.error('Error opening sound settings:', error);
                alert('Could not open sound settings automatically. Please open them manually from the Windows settings.');
            }
        }

        async function testSetup() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const audioInputs = devices.filter(device => device.kind === 'audioinput');
                
                console.log('Available input devices:', audioInputs.map(d => d.label));
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                const tracks = stream.getAudioTracks();
                if (tracks.length > 0) {
                    const deviceLabel = tracks[0].label;
                    console.log('Currently using device:', deviceLabel);
                    
                    if (deviceLabel.toLowerCase().includes('cable') || 
                        deviceLabel.toLowerCase().includes('vb-audio')) {
                        alert('âœ… Great! VB-Audio Cable is set as your default microphone.');
                    } else {
                        alert('âš ï¸ It looks like VB-Audio Cable is not your default microphone yet. Please follow the steps above to set it up.');
                    }
                } else {
                    alert('âš ï¸ Could not detect your current microphone. Please check your audio permissions.');
                }
                
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                console.error('Error testing setup:', error);
                alert('Could not test your setup. Please make sure you have given microphone permissions to this app.');
            }
        }

        async function closeOverlay() {
            try {
                await window.electronAPI.setVbAudioSetupShown(true);
                await window.electronAPI.closeVbAudioSetup();
            } catch (error) {
                console.error('Error closing overlay:', error);
                if (window.close) {
                    window.close();
                }
            }
        }

        window.addEventListener('beforeunload', async () => {
            try {
                await window.electronAPI.setVbAudioSetupShown(true);
            } catch (error) {
                console.warn('Could not save preference:', error);
            }
        });
    </script>
</body>
</html>
